<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>Escenas 3D - DBC</title>

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }

      #environmentDiv {
        position: absolute;
        top: 12px;
        right: 12px;
        padding: 12px;
        background-color: rgba(0, 0, 0, 0.5);
        color: white;
      }
    </style>

    <link
      rel="stylesheet"
      href="https://js.arcgis.com/4.27/esri/themes/light/main.css"
    />
    <script src="https://js.arcgis.com/4.27/"></script>

    <script>
      require([
        "esri/Map",
        "esri/views/SceneView",
        "esri/layers/SceneLayer",
      ], function (Map, SceneView, SceneLayer) {

        // Se crea el mapa con terreno de elevación
        var map = new Map({
          basemap: "streets",
          ground: "world-elevation",
        });

        // Se crea la vista 3D (SceneView)
        var view = new SceneView({
          container: "viewDiv",
          map: map,
          camera: {
            position: [9.993682, 53.53, 2408],
            tilt: 50
          }
        });

        // Se configuran las propiedades del entorno de la escena
        view.environment = {
          lighting: {
            date: new Date("Sun Mar 15 2023 18:00:00 GMT+0100 (CET)"),
            directShadowsEnabled: true,
          },
        };

        // Se crea la SceneLayer a partir de un elemento de ArcGIS Online
        let sceneLayer = new SceneLayer({
          portalItem: {
            id: "327d6b60509f4ddab12ee5a424fac7de",
          },
        });

        // Se añade la SceneLayer al mapa
        map.add(sceneLayer);

        // Eventos de los controles de entorno
        document
          .getElementById("timeOfDaySelect")
          .addEventListener("change", updateTimeOfDay);

        document
          .getElementById("directShadowsInput")
          .addEventListener("change", updateDirectShadows);

        // Se actualiza la hora del día en la iluminación
        function updateTimeOfDay(ev) {
          var select = ev.target;
          var date = select.options[select.selectedIndex].value;
          view.environment.lighting.date = new Date(date);
        }

        // Se activan o desactivan las sombras directas
        function updateDirectShadows(ev) {
          view.environment.lighting.directShadowsEnabled = !!ev.target.checked;
        }
      });
    </script>
  </head>

  <body>
    <div id="viewDiv"></div>

    <div id="environmentDiv">
      <table>
        <tr>
          <td>Time of day:</td>
          <td>
            <select id="timeOfDaySelect">
              <option value="Sun Mar 15 2015 09:00:00 GMT+0200 (CET)">
                Morning
              </option>
              <option value="Sun Mar 15 2015 12:00:00 GMT+0200 (CET)">
                Noon
              </option>
              <option value="Sun Mar 15 2015 16:00:00 GMT+0200 (CET)">
                Afternoon
              </option>
              <option value="Sun Mar 15 2015 18:00:00 GMT+0200 (CET)">
                Evening
              </option>
            </select>
          </td>
        </tr>
        <tr>
          <td>Direct shadows:</td>
          <td><input id="directShadowsInput" type="checkbox" checked /></td>
        </tr>
      </table>
    </div>
  </body>
</html>
